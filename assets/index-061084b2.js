import{i as ee,l as V,n as te,o as se,j as e,p as G,q,x as M,a as B,A as $,U as D,g as _,r as m,z as O,u as z,b as r,S as ae,e as u,T as w,E as re,I as ne,G as oe,B as Q,y as le,J as ie,C as ce,R as de,K as P,M as me,H as g,F as he,f as E}from"./index-82733b58.js";import{h as C}from"./moment-e9e012b5.js";import{F as U}from"./index.esm-baf20854.js";import{F as ue}from"./index.esm-bcfda23f.js";import{w as K,B as fe}from"./withStatus-59df8a06.js";import{S as W}from"./chunk-XOVTCM5B-9b243b38.js";import{A as ge}from"./chunk-VJ54TX72-f424b5a1.js";import{D as pe}from"./index-2a0be078.js";import{I as xe}from"./chunk-3HSDMH4Y-1a70a519.js";import{R as we}from"./index-a9922210.js";import{P as Se}from"./index-f5f90fff.js";import"./iconBase-94f617a1.js";import"./chunk-LB6CWFOC-1198bd88.js";import"./chunk-Z3IFIKNA-de6e62c4.js";import"./chunk-3XANSPY5-cf37bc50.js";import"./index-01e141de.js";import"./useMobile-94845e00.js";import"./index.esm-cc4aab74.js";import"./chunk-JIPYISAW-16bb16c3.js";import"./chunk-ROURZMX4-1c85f1b1.js";import"./chunk-XY72533R-e88ac3d9.js";import"./chunk-CHB4ZXZG-c62fd995.js";import"./chunk-UC35PMV4-bc7790c7.js";var[ve,X]=ee({name:"StatStylesContext",errorMessage:`useStatStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Stat />" `}),N=V(function(s,c){const n=te("Stat",s),t={position:"relative",flex:"1 1 0%",...n.container},{className:S,children:b,...p}=se(s);return e(ve,{value:n,children:e(G.div,{ref:c,...p,className:q("chakra-stat",S),__css:t,children:e("dl",{children:b})})})});N.displayName="Stat";var F=V(function(s,c){const n=X();return e(G.dt,{ref:c,...s,className:q("chakra-stat__label",s.className),__css:n.label})});F.displayName="StatLabel";var R=V(function(s,c){const n=X();return e(G.dd,{ref:c,...s,className:q("chakra-stat__number",s.className),__css:{...n.number,fontFeatureSettings:"pnum",fontVariantNumeric:"proportional-nums"}})});R.displayName="StatNumber";const ye=async l=>{const s={component:"components/EventView/calls.getEventById"};let c=null;try{console.log("Trying to fetch the Events",{...s});const n=M("_auth"),t=await B.get(`${$}/v1/events/${l}`,{headers:{Authorization:`Bearer ${n}`}});if(t.status===200&&t.data.code.id===D.SUCCESS_CODE)return{success:!0,data:t.data.content};c=_(t)}catch(n){console.error("Unexpected error while trying to fetch the Events",n)}return{success:!1,data:c}};async function Z(l){const s={component:"components/EventView.calls.getEventReservation",params:{eventId:l}};let c=null;try{console.log("Trying to get Event Reservations",{...s});const n=M("_auth"),t=await B.get(`${$}/v1/reservations/event/${l}`,{headers:{Authorization:`Bearer ${n}`}});if(t.status===200&&t.data.code.id===D.SUCCESS_CODE)return{success:!0,data:t.data.content};c=_(t)}catch(n){console.error("An unexpected error while updating draft reservation",{...s,error:n})}return{success:!1,data:c}}async function be(l){const s={component:"components/EventView.calls.getEventSales",params:{eventId:l}};let c=null;try{console.log("Trying to get Event Sales",{...s});const n=M("_auth"),t=await B.get(`${$}/v1/statistics/event/${l}/sales`,{headers:{Authorization:`Bearer ${n}`}});if(t.status===200&&t.data.code.id===D.SUCCESS_CODE)return{success:!0,data:t.data.content};c=_(t)}catch(n){console.error("An unexpected error while getting event clients",{...s,error:n})}return{success:!1,data:c}}async function Ee(l){const s={component:"components/EventView.calls.getEventClients",params:{eventId:l}};let c=null;try{console.log("Trying to get Event Reservations",{...s});const n=M("_auth"),t=await B.get(`${$}/v1/statistics/event/${l}/clients`,{headers:{Authorization:`Bearer ${n}`}});if(t.status===200&&t.data.code.id===D.SUCCESS_CODE)return{success:!0,data:t.data.content};c=_(t)}catch(n){console.error("An unexpected error while getting event sales",{...s,error:n})}return{success:!1,data:c}}const Ce=({eventId:l,statuses:s,onOpen:c,onCreate:n})=>{const[t,S]=m.useState([]),[b,p]=m.useState([]),[I,T]=m.useState(!1),[J,d]=m.useState(null),[v,L]=m.useState(""),[k,A]=m.useState("");m.useMemo(()=>{if(s)return Object.keys(s.Reservation).map(i=>({key:s.Reservation[i],text:O(s.Reservation,s.Reservation[i]).tag}))},[s]);const x=[{header:"ID",accessor:"id"},{header:"Host Name",accessor:"ClientLists",render:i=>{const h=i.find(o=>t.find(a=>a.OwnerId===o.ClientId)).Client;return`${h.firstName} ${h.lastName}`}},{header:"Host Phone",accessor:"OwnerId",render:i=>`${t.find(a=>a.ClientLists.find(H=>H.Client.id===i)).ClientLists.find(a=>a.Client.id===i).Client.phone}`},{header:"Host Email",accessor:"OwnerId",render:i=>`${t.find(a=>a.ClientLists.find(H=>H.Client.id===i)).ClientLists.find(a=>a.Client.id===i).Client.email}`},{header:"Status",accessor:"StatusId",render:i=>e(fe,{colorScheme:le(O(s.Reservation,i).tag||""),children:O(s.Reservation,i).tag})},{header:"Created At",accessor:"createdAt",render:i=>C(i).tz("America/Toronto").format("YYYY-MM-DD HH:mm")},{header:"Created By",accessor:"createdBy"}],f=z("white","gray.700"),Y=z("gray.500","gray.400"),y=()=>{const i=[];t.forEach(h=>{h.ClientLists.forEach(o=>{Object.values(o.Client).join(" ").toLowerCase().includes(v.toLowerCase())&&i.push(h)})}),p(i)},j=async i=>{T(!0);try{const h=await Z(i);if(!h.success)throw new Error(h.data);S(h.data),p(h.data)}catch(h){console.error(`Unepxected error : ${h.message}`),d({type:"error",message:h.message})}T(!1)};return m.useEffect(()=>{l&&j(l)},[l]),m.useEffect(()=>{v.length===0?p(t):y()},[v,k]),r("div",{className:"w-full h-full",children:[I&&e("div",{className:"flex justify-center",children:e(ae,{size:"md"})}),e(u,{bg:f,py:3,mb:5,children:r("div",{className:"w-full flex lg:flex-row flex-col items-center",children:[e("div",{className:"flex lg:flex-row flex-col lg:space-x-4 w-full",children:r(u,{className:"lg:w-8/12 w-full mb-3 flex flex-col",children:[e(w,{className:"text-relaxed font-medium ml-1 mb-2",color:Y,children:"Search reservation"}),r(re,{children:[e(ne,{bg:f,shadow:"md",placeholder:"Search",value:v,onChange:i=>L(i.target.value)}),e(oe,{children:e(xe,{color:z("gray.600","gray.50"),"aria-label":"Search",icon:e(W,{}),onClick:y})})]})]})}),r("div",{className:"lg:w-4/12 justify-end w-full mt-3 flex sm:flex-row flex-col",children:[r(Q,{variant:"solid",colorScheme:"green",size:{base:"sm",md:"md"},onClick:n,my:{base:5,sm:15},mr:5,children:[e(ge,{boxSize:3,mr:3}),"Create a Reservation"]}),r(Q,{variant:"solid",colorScheme:"blue",size:{base:"sm",md:"md"},mr:4,onClick:y,my:{base:5,sm:15},children:[e(W,{boxSize:3,mr:3}),"Search"]})]})]})}),e(pe,{columns:x,items:b,onOpenRecord:c})]})},Ne=K(Ce),Fe=l=>{const{eventId:s}=ie(),c=ce(),[n,t]=m.useState(!1),[S,b]=m.useState([]),[p,I]=m.useState(null),[T,J]=m.useState(null),[d,v]=m.useState(null),[L,k]=m.useState(!1),[A,x]=m.useState(null),f=z("white","gray.700");z("gray.50","gray.700");const Y=async()=>{t(!0),x(null);try{const o=await ye(parseInt(s,10));if(!o.success)throw new Error(o.data);if(o.data===null)throw new Error("An error occurred while trying to get the Event");v(o.data)}catch(o){console.error(`Unexpected error while getting the Event : ${o.message}`,{...o}),x({type:"error",message:o.message})}t(!1)};m.useEffect(()=>{s&&l.statuses&&Y()},[l.statuses]);const y=async o=>{t(!0);try{const a=await Z(o);if(!a.success)throw new Error(a.data);b(a.data)}catch(a){console.error(`Unepxected error : ${a.message}`),x({type:"error",message:a.message})}t(!1)},j=async o=>{t(!0);try{const a=await Ee(o);if(!a.success)throw new Error(a.data);I(a.data)}catch(a){console.error(`Error : ${a.message}`),x({type:"error",message:a.message})}t(!1)},i=async o=>{t(!0);try{const a=await be(o);if(!a.success)throw new Error(a.data);J(a.data)}catch(a){console.error(`Error : ${a.message}`),x({type:"error",message:a.message})}t(!1)},h=()=>{k(!0)};return m.useEffect(()=>{d&&d.id&&(y(d.id),j(d.id),i(d.id))},[d]),r(de.Fragment,{children:[A&&e(P,{children:e(me,{type:A.type,message:A.message})}),!d&&!n&&r(u,{textAlign:"center",py:10,px:6,children:[e(g,{display:"inline-block",as:"h2",size:"2xl",bgGradient:"linear(to-r, teal.400, teal.600)",backgroundClip:"text",children:"404"}),e(w,{fontSize:"18px",mt:3,mb:2,children:"Event Not Found"}),e(w,{color:"gray.500",mb:6,children:"The record you're looking for does not seem to exist"})]}),d&&r(he,{children:[e(P,{children:e(u,{textAlign:"left",my:5,p:3,children:e(g,{children:d.name})})}),r(E,{flexDirection:{base:"column",md:"row"},justifyContent:"space-between",children:[e(u,{bg:f,width:{md:"350px",sm:"100%"},p:"5",borderRadius:"15px",boxShadow:"lg",my:{base:5,md:0},mx:{base:0,md:2},children:r(N,{children:[e(F,{mb:2,children:r(E,{justifyContent:"space-between",children:[e(g,{as:"h2",size:"md",children:"Total Clients"}),e(u,{display:{base:"none",md:"flex"},color:"#FFFFFF",bg:"#3182CE",p:"3",borderRadius:"15px",children:e(U,{size:28})})]})}),e(R,{children:e(w,{fontSize:"4xl",children:p||0})})]})}),e(u,{bg:f,width:{md:"350px",sm:"100%"},p:"5",borderRadius:"15px",boxShadow:"lg",my:{base:5,md:0},mx:{base:0,md:2},children:r(N,{children:[e(F,{mb:2,children:r(E,{justifyContent:"space-between",children:[e(g,{as:"h2",size:"md",children:"Total Reservations"}),e(u,{display:{base:"none",md:"flex"},color:"#FFFFFF",bg:"#3182CE",p:"3",borderRadius:"15px",children:e(U,{size:28})})]})}),e(R,{children:e(w,{fontSize:"4xl",children:S.length&&(S.filter(o=>o.StatusId!==l.statuses.Reservation.CANCELLED).length||0)})})]})}),e(u,{bg:f,width:{md:"350px",sm:"100%"},p:"5",borderRadius:"15px",boxShadow:"lg",my:{base:5,md:0},mx:{base:0,md:2},children:r(N,{children:[e(F,{mb:2,children:r(E,{justifyContent:"space-between",children:[e(g,{as:"h2",size:"md",children:"Event Capacity"}),e(u,{display:{base:"none",md:"flex"},color:"#FFFFFF",bg:"#3182CE",p:"3",borderRadius:"15px",children:e(U,{size:28})})]})}),e(R,{children:e(w,{fontSize:"4xl",children:d.capacity})})]})}),e(u,{bg:f,width:{md:"350px",sm:"100%"},p:"5",borderRadius:"15px",boxShadow:"lg",my:{base:5,md:0},mx:{base:0,md:2},children:r(N,{children:[e(F,{mb:2,children:r(E,{justifyContent:"space-between",children:[e(g,{as:"h2",size:"md",children:"Total Sales"}),e(u,{display:{base:"none",md:"flex"},color:"#FFFFFF",bg:"#3182CE",p:"3",borderRadius:"15px",children:e(ue,{size:28})})]})}),e(R,{children:r(w,{fontSize:"4xl",children:["$",T||0]})})]})})]}),r("div",{className:"flex lg:flex-row flex-col w-full",children:[r(u,{bg:f,className:"shadow-md rounded-xl p-5 lg:w-6/12 w-full mx-3 my-5",children:[e(g,{as:"h3",size:"lg",mx:1,mb:4,children:"Event Info"}),r("div",{className:"flex flex-row justify-between w-full my-10",children:[r("div",{className:"text-left w-full ml-3 flex flex-col",children:[e("span",{className:"font-bold text-sm ",children:"Start Time"}),e("span",{className:"text-base font-medium tracking-wide",children:C(d.startTime).tz("America/Toronto").utc().format("DD MMM, YYYY [at] HH:mma")})]}),r("div",{className:"text-left w-full ml-10 flex flex-col",children:[e("span",{className:"font-bold text-sm tracking-wide leading-relaxed",children:"End Time"}),e("span",{className:"text-base font-medium tracking-wide",children:C(d.endTime).tz("America/Toronto").utc().format("DD MMM, YYYY [at] HH:mma")})]})]}),e("div",{className:"w-full h-96",children:e(u,{as:"iframe",className:"w-full h-full",style:{border:0},loading:"lazy",allowFullScreen:!0,referrerPolicy:"no-referrer-when-downgrade",src:`https://www.google.com/maps/embed/v1/place?key=AIzaSyBxr53jBD1xjSQcESLr86hAkmBpDJ4R690&q=${d.location}`})})]}),r(u,{bg:f,className:"shadow-md rounded-xl p-5 lg:w-6/12  w-full mx-3 my-5",children:[e(g,{as:"h3",size:"lg",className:"mb-5",children:"Tickets"}),d.saleStart&&d.saleEnd&&r("div",{className:"flex flex-row justify-between w-full my-10",children:[r("div",{className:"text-left w-full ml-3 flex flex-col",children:[e("span",{className:"font-bold text-sm ",children:"Tickets Sale Start"}),e("span",{className:"text-base font-medium tracking-wide",children:C(d.startTime).tz("America/Toronto").utc().format("DD MMM, YYYY [at] HH:mma")})]}),r("div",{className:"text-left w-full ml-10 flex flex-col",children:[e("span",{className:"font-bold text-sm tracking-wide leading-relaxed",children:"Ticket Sale End:"}),e("span",{className:"text-base font-medium tracking-wide",children:C(d.endTime).tz("America/Toronto").utc().format("DD MMM, YYYY [at] HH:mma")})]})]}),e("div",{className:"w-full h-full",children:l.statuses&&d.Prices&&e(Se,{prices:d.Prices.filter(o=>o.StatusId===l.statuses.Price.ACTIVE)})})]})]}),e(P,{children:r(u,{bg:f,textAlign:"left",my:5,p:5,borderRadius:"15px",boxShadow:"s",children:[e(g,{as:"h3",size:"lg",children:"Reservations for event"}),l.statuses&&e(Ne,{eventId:s,onCreate:h,statuses:l.statuses,onOpen:o=>{c(`/events/${s}/reservation/${o.id}`)}})]})})]}),e(we,{isOpen:L,onClose:()=>{k(!1),y(s)},eventId:s})]})},We=K(Fe);export{We as default};
