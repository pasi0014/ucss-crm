import{v as ee,b as n,y as W,z as pe,j as e,w as ge,x as fe,aL as ye,a3 as ve,r as m,aM as we,m as u,aN as xe,M as te,aO as be,e as ne,d as se,f as ae,h as z,k as I,n as C,B as N,i as T,I as k,Y as Se,ae as Ee,Z as Ce,aP as Te,aQ as Ie,aR as re,l as ke,W as G,F as Q,H as j,u as S,a1 as Ne,aS as De,aT as Ue,aU as Pe,aV as _e,K as $,a as O,A as q,U as H,g as V,Q as X,aW as Fe,a2 as Me,aX as Re,aY as Le,aZ as Be,a_ as Ae,D as je,c as ze,a$ as $e,b0 as Oe,b1 as qe,b2 as He,b3 as Ve,b4 as J,b5 as Ye,b6 as We,b7 as Ge,b8 as Qe}from"./index-66657976.js";import{i as Ze}from"./browser-image-compression-78ff6def.js";import Xe from"./index-da574847.js";import{D as Y}from"./chunk-YGVX4ESO-cde3bb81.js";var oe=ee(function(s,r){const{children:o,placeholder:c,className:d,...h}=s;return n(W.select,{...h,ref:r,className:pe("chakra-select",d),children:[c&&e("option",{value:"",children:c}),o]})});oe.displayName="SelectField";function Je(t,s){const r={},o={};for(const[c,d]of Object.entries(t))s.includes(c)?r[c]=d:o[c]=d;return[r,o]}var ie=ee((t,s)=>{var r;const o=ge("Select",t),{rootProps:c,placeholder:d,icon:h,color:y,height:x,h:p,minH:v,minHeight:E,iconColor:l,iconSize:a,...w}=fe(t),[D,F]=Je(w,we),_=ye(F),f={width:"100%",height:"fit-content",position:"relative",color:y},b={paddingEnd:"2rem",...o.field,_focus:{zIndex:"unset",...(r=o.field)==null?void 0:r._focus}};return n(W.div,{className:"chakra-select__wrapper",__css:f,...D,...c,children:[e(oe,{ref:s,height:p??x,minH:v??E,placeholder:d,..._,__css:b,children:t.children}),e(ce,{"data-disabled":ve(_.disabled),...(l||y)&&{color:l||y},__css:o.icon,...a&&{fontSize:a},children:h})]})});ie.displayName="Select";var Ke=t=>e("svg",{viewBox:"0 0 24 24",...t,children:e("path",{fill:"currentColor",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"})}),et=W("div",{baseStyle:{position:"absolute",display:"inline-flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",top:"50%",transform:"translateY(-50%)"}}),ce=t=>{const{children:s=e(Ke,{}),...r}=t,o=m.cloneElement(s,{role:"presentation",className:"chakra-select__icon",focusable:!1,"aria-hidden":!0,style:{width:"1em",height:"1em",color:"currentColor"}});return e(et,{...r,className:"chakra-select__icon-wrapper",children:m.isValidElement(s)?o:null})};ce.displayName="SelectIcon";const tt=({isOpen:t,price:s,eventId:r,onCreate:o,onClose:c})=>{const[d,h]=m.useState({}),[y,x]=m.useState(!1),[p,v]=m.useState({ticketType:"paid",name:"",amount:0,EventId:r}),E=()=>{v({ticketType:"paid",name:"",amount:0,EventId:r})},l=w=>{const{name:D,value:F}=w.target;v(_=>({..._,[D]:F}))},a=w=>{v(D=>({...D,...w}))};return m.useEffect(()=>{(s==null?void 0:s.id)!==void 0&&a(s)},[s]),e(u,{children:n(xe,{isOpen:t,onClose:()=>{E(),c()},children:[e(te,{}),n(be,{children:[e(ne,{children:"Create a ticket"}),e(se,{}),n(ae,{pb:6,children:[n(u,{mb:"20px",children:[y&&e(u,{my:15,children:e(z,{type:d.type,message:d.message})}),e(I,{children:"Ticket Type"}),n(C,{direction:{base:"column",md:"row"},mt:{base:"25px",md:"5px"},children:[e(N,{variant:p.ticketType==="paid"?"solid":"outline",mb:{base:"5",md:"0"},mr:"15px",width:{base:"100%",md:"130px"},onClick:()=>v({...p,ticketType:"paid"}),children:"Paid"}),e(N,{variant:p.ticketType==="free"?"solid":"outline",width:{base:"100%",md:"130px"},onClick:()=>v({...p,ticketType:"free",amount:0}),children:"Free"})]})]}),n(T,{isRequired:!0,children:[e(I,{children:"Ticket Name"}),e(k,{type:"text",name:"name",value:p.name,onChange:l})]}),n(T,{mt:5,isRequired:!0,children:[e(I,{children:"Amount"}),n(Se,{children:[e(Ee,{pointerEvents:"none",color:"gray.300",fontSize:"1.2em",children:"$"}),e(k,{disabled:p.ticketType==="free",type:"number",name:"amount",value:p.amount,onChange:l}),e(Ce,{children:e(Te,{color:"green.500"})})]})]})]}),n(Ie,{children:[e(N,{colorScheme:"blue",mr:3,onClick:()=>o(p),children:"Save"}),e(N,{onClick:()=>{E(),c()},children:"Cancel"})]})]})]})})};function nt(t){const s=re(),{isOpen:r,onOpen:o,onClose:c}=ke(),{setAppLoading:d}=m.useContext(G),[h,y]=m.useState([]),[x,p]=m.useState({}),[v,E]=m.useState(null),[l,a]=m.useState(!1),w=f=>{E(f),o()},D=async f=>{d(!0),a(!1),console.log("Deleting price");try{if(!(await Ue(f.id)).success)throw new Error("Unexpected error : could not delete the event price");const R=h.filter(U=>U.id!==f.id);y(R),s({title:"Price Deleted Successfully!",description:`You have deleted ticket ${f.name}`,position:"top-right",status:"success",duration:9e3,isClosable:!0})}catch(b){console.error("Unepxected error while trying to delete the Event Price",{...b}),a(!0),p({type:"error",messages:b.message})}d(!1)},F=async()=>{d(!0),a(!1),console.log("Fetching price");try{const f=await Pe(t.eventId);if(!f.success)throw new Error("Unexpected error : could not fetch the event price");y(f.data)}catch(f){console.error("Unepxected error while trying to find the Event Price",{...f}),a(!0),p({type:"error",messages:f.message})}d(!1)},_=async f=>{d(!0),a(!1);try{const b=await _e(f);if(!b.success)throw a(!0),p({type:"error",message:"Unexpected error while trying to create Price"}),new Error(b.data);const R=h.findIndex(U=>U.id===f.id);y(R===-1?U=>[...U,f]:U=>{const B=[...U];return B[R]=f,B}),s({title:"Price Saved Successfully!",description:`You have saved ticket ${f.name}`,position:"top-right",status:"success",duration:9e3,isClosable:!0}),c(),p({type:"success",message:"Price was successfully saved"})}catch(b){console.error("Unexpected error while trying to save Price",{...b}),p({type:"error",message:b.message})}d(!1)};return m.useEffect(()=>{t.eventId&&F()},[]),n(Q,{children:[e(u,{mt:"15px",children:e(j,{as:"h3",size:"lg",my:5,children:"Create a Ticket(s) for your event"})}),l&&e(u,{mb:5,children:e(z,{type:x.type,message:x.message})}),e(u,{mb:"15px",children:n(N,{bg:S("green.400","green.500"),_hover:{bg:S("green.300","green.400")},color:S("white","gray.100"),onClick:o,children:[e(Ne,{boxSize:3,mr:"5px"}),"Add a Ticket"]})}),e(tt,{isOpen:r,onClose:()=>{c(),E(null)},price:v,onCreate:f=>_(f),eventId:t.eventId}),e(j,{size:"md",children:"Tickets"}),e(u,{className:"sm:w-6/12 w-full",children:e(De,{prices:h,statuses:t.statuses,onDelete:D,onEdit:w})})]})}const st=async t=>{const s={component:"component/EventForm.fetchLocationSuggestions",params:{location:t}};let r=null;try{console.log("Getting locaiton autosuggestion",{...s});const o=$("_auth"),c=await O.get(`${q}/v1/locations?query=${t}`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`}});if(c.status===200&&c.data.code.id===H.SUCCESS_CODE)return{success:!0,data:c.data.content};r=V(c)}catch(o){console.error("Unexpected error while trying to get Location suggestions",{...s,error:o})}return{success:!1,data:r}},at=async t=>{const s={component:"components/EventForm/calls.updateEvent",params:{event:t}};let r=null;try{console.log("Trying to update the Event",{...s});const c={event:{...t}},d=$("_auth"),h=await O.put(`${q}/v1/events/${t.id}`,c,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`}});if(h.status===200&&h.data.code.id===H.SUCCESS_CODE)return{success:!0,data:h.data.content};r=V(h)}catch(o){console.error("Unexpected error while trying to update the Event",{...s,error:o})}return{success:!1,data:r}},le=async t=>{const s={component:"components/EventDrawer/calls.findEventById",params:{eventId:t}};let r=null;try{console.log("Trying to find Event by id",{...s});const o=$("_auth"),c=await O.get(`${q}/v1/events/${t}`,{headers:{Authorization:`Bearer ${o}`}});if(c.status===200&&c.data.code.id===H.SUCCESS_CODE)return{success:!0,data:c.data.content};r=V(c)}catch(o){console.error("Unexpected error while trying to find Event by ID",{...s,error:o})}return{success:!1,data:r}},rt=async t=>{const s={component:"components/EventDrawer/calls.createEvent",params:{event:t}};let r=null;try{console.log("Trying to create Event",{...s});const c={event:{...t}},d=$("_auth"),h=await O.post(`${q}/v1/events`,c,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`}});if(h.status===200&&h.data.code.id===H.SUCCESS_CODE)return{success:!0,data:h.data.content};r=V(h)}catch(o){console.error("Unexpected error while trying to create an Event",o)}return{success:!1,data:r}},ot=t=>{const s=re(),{setAppLoading:r}=m.useContext(G),[o,c]=m.useState(t.statuses.Event.DRAFT),d=m.useMemo(()=>Object.keys(t.statuses.Event).map(l=>({key:t.statuses.Event[l],text:X(t.statuses.Event,t.statuses.Event[l]).tag})),[]),[h,y]=m.useState(!1),[x,p]=m.useState({}),v=async()=>{r(!0),y(!1);try{const l=await le(t.eventId);if(!l.success)throw y(!0),new Error(`Error : ${l.data}`);c(l.data.StatusId)}catch(l){console.error("Unexpected error while contacting UcssAPI to get Event Status",{...l}),p({type:"error",message:l.message})}r(!1)},E=async()=>{r(!0),y(!1);try{const l=await Fe(o,t.eventId);l.success||(y(!0),p({type:"error",message:"Unexpected error while trying to update Event's Status"})),s({title:"Event Status updated!",description:`The Event status has been set to ${X(t.statuses.Event,l.data.StatusId).tag}.`,position:"top-right",status:"success",duration:9e3,isClosable:!0})}catch(l){console.log("Unexpected error while trying to update Event's Status"),p({type:"error",message:l.message})}r(!1)};return m.useEffect(()=>{let l=!0;return l&&v(),()=>{l=!1}},[]),n(Q,{children:[e(u,{children:e(j,{as:"h3",size:"md",mt:10,mb:5,children:"Publish the event"})}),h&&e(u,{mb:5,children:e(z,{type:x.type,message:x.message})}),e(u,{children:e(ie,{placeholder:"Select a status",value:o,onChange:l=>{c(l.target.value)},children:d.map(l=>e("option",{value:l.key,children:l.text},l.key))})}),e(C,{children:e(N,{mt:7,_hover:{bg:S("green.400","green.500")},color:S("white","gray.100"),bg:S("green.500","green.600"),onClick:E,children:"Update Status"})})]})};function it(t){const{appLoading:s,setAppLoading:r}=m.useContext(G),[o,c]=m.useState([]),[d,h]=m.useState(!1),[y,x]=m.useState(!1),[p,v]=m.useState({}),[E,l]=m.useState(""),[a,w]=m.useState({name:"",imageURL:null,description:"",startTime:"",endTime:"",location:"",capacity:0}),D=S("border-gray-300","border-gray-500"),F=S("white","gray.500"),_=async i=>{h(!0);try{const g=await st(i);if(!g.success)throw new Error("Could not fetch location suggestion");c(g.data.items.map(P=>P.address.label)),h(!1)}catch(g){console.error("Error fetching location suggestions:",g)}h(!1)},f=i=>{const{name:g,value:P}=i.target;w(L=>({...L,[g]:P})),P.length!==0&&P.length>=3&&setTimeout(()=>{_(P)},1e3)},b=i=>{const{name:g,value:P}=i.target;w(L=>({...L,[g]:P}))},R=i=>{w(g=>({...g,description:i}))},U=async i=>{const g=i.target.files[0],L=await Ze(g,{maxSizeMB:1,maxWidthOrHeight:1920,useWebWorker:!0});if(L){const A=new FileReader;A.onload=()=>{w(he=>({...he,imageURL:A.result}))},A.readAsDataURL(L)}else w(A=>({...A,imageURL:null}))},B=i=>{w(g=>({...g,...i}))},de=async()=>{r(!0),x(!1);try{const i=await le(t.eventId);if(!i.success)throw x(!0),v({type:"error",message:i.data}),new Error(i.data);B(i.data)}catch(i){console.error("Error : ",{...i})}r(!1)},ue=async()=>{if(r(!0),x(!1),!me()){r(!1);return}try{const i={...a};let g=null;if(t.eventId?g=await at(i):g=await rt(i),!g.success)throw x(!0),v({type:"error",message:"Unexpected error while trying to create an Event"}),new Error(`There was an error while tryting to create the Event ${g.data}`);B(g.data),t.onEventUpdate(g.data.id),t.onNext()}catch(i){console.error("Unexpected error: ",i.message)}r(!1)},Z=()=>{w({name:"",description:"",startTime:"",endTime:"",imageURL:null,location:"",capacity:0}),x(!1)},me=()=>{const i={};return a.name.length||(i.nameError=!0),a.startTime.length||(i.startTime=!0),a.endTime.length||(i.endTime=!0),Object.keys(i).length?(x(!0),v({type:"error",message:"The form contains errors. Please enter all required information"}),!1):(x(!1),v({}),!0)},M=i=>Le(i).tz("America/Toronto").format("YYYY-MM-DDTHH:mm");return m.useEffect(()=>{if(a.startTime&&a.startTime.length&&!a.endTime&&a.endTime.length){const i=M(new Date(a.startTime));w(g=>({...g,endTime:i})),l(i)}},[a.startTime]),m.useEffect(()=>{t.eventId&&de()},[]),m.useEffect(()=>()=>Z(),[]),n(u,{children:[e(u,{mt:"15px",children:e(j,{as:"h3",size:"lg",my:5,mx:{base:"15px",sm:"5px"},children:"Fill in Event information"})}),y&&e(u,{mb:5,children:e(z,{type:p.type,message:p.message})}),n(u,{className:`${D} border w-full rounded-lg flex flex-col items-center my-6`,p:{base:"0px",md:"25px"},bg:S("gray.50","gray.700"),children:[n(u,{className:"w-full flex md:flex-row flex-col",children:[n(u,{className:"md:w-4/12 w-full p-3 flex flex-col",children:[e("span",{className:"text-md font-bold w-full",children:"Event Information"}),e("span",{className:"mt-2 text-sm w-10/12",children:"This information will be used to be displayed on the website."})]}),n(u,{className:"sm:w-10/12 w-full p-3",children:[e(C,{direction:{base:"column",md:"row"},justifyContent:"space-between",children:n(T,{mr:"5%",isRequired:!0,children:[e(I,{children:"Event Name"}),e(k,{type:"text",name:"name",value:a.name,disabled:s,onChange:b})]})}),e(C,{direction:{base:"column",md:"row"},justifyContent:"space-between",mt:5,children:n(T,{mr:"5%",isRequired:!0,children:[e(I,{children:"Event Description"}),e(Xe,{initialContent:a.description,onSave:R})]})})]})]}),e(Y,{my:10}),n(u,{className:"w-full flex md:flex-row flex-col",children:[n(u,{className:"md:w-4/12 w-full p-3 flex flex-col",children:[e("span",{className:"text-md font-bold w-full",children:"Event Image"}),e("span",{className:"mt-2 text-sm w-10/12",children:"Upload an image, it will be used as a event main image."})]}),e(u,{className:"sm:w-10/12 w-full p-3",children:n(C,{direction:{base:"column"},justifyContent:"space-between",children:[e(T,{mr:"5%",isRequired:!0,children:e(k,{type:"file",accept:"image/*",onChange:U,p:1})}),e(u,{my:5,children:a.imageURL&&e("img",{src:a.imageURL,alt:"Preview",style:{maxWidth:"100px"}})})]})})]}),e(Y,{my:10}),n(u,{className:"w-full flex md:flex-row flex-col",children:[n(u,{className:"md:w-4/12 w-full p-3 flex flex-col",children:[e("span",{className:"text-md font-bold w-full",children:"Date and location"}),e("span",{className:"mt-2 text-sm w-10/12",children:"Please, fill in the location's date and location."})]}),n(u,{className:"w-10/12 p-3",children:[n(C,{direction:{base:"column",md:"row"},justifyContent:"space-between",children:[n(T,{mr:"5%",isRequired:!0,children:[e(I,{children:"Start time"}),e(k,{type:"datetime-local",name:"startTime",value:M(a.startTime&&a.startTime.length?new Date(a.startTime):new Date),onChange:b,disabled:s,min:M(new Date)})]}),n(T,{mr:"5%",ml:{base:"0",md:"5"},isRequired:!0,children:[e(I,{children:"End time"}),e(k,{type:"datetime-local",name:"endTime",value:M(new Date(a.endTime)),disabled:s,onChange:b,min:E})]})]}),n(C,{direction:{base:"column"},justifyContent:"space-between",mt:5,children:[n(T,{mt:5,isRequired:!0,children:[e(I,{children:"Location"}),e(k,{type:"text",name:"location",value:a.location,disabled:s,onChange:f})]}),n(u,{children:[d&&n(C,{p:5,children:[e(Me,{size:"sm",mr:2}),"Loading..."]}),o.length>0&&e(Re,{in:!!o.length,children:e(u,{bg:F,boxShadow:"md",p:3,mt:3,children:o.map(i=>e(u,{borderRadius:"5px",my:2,boxShadow:"sm",border:"1px",_hover:{cursor:"pointer",backgroundColor:"teal.500",color:"white"},children:e("button",{className:"flex flex-col text-left justify-items-start p-3 w-full rounded-xl",value:i,onClick:()=>{w(g=>({...g,location:i})),c([])},children:e("span",{children:i})})},crypto.randomUUID()))})})]})]}),e(C,{direction:{base:"column",md:"row"},justifyContent:"space-between",children:n(T,{mt:5,isRequired:!0,children:[e(I,{children:"Event Capacity"}),e(k,{type:"number",name:"capacity",value:a.capacity,disabled:s,onChange:b})]})})]})]}),e(Y,{my:10}),n(u,{className:"w-full flex md:flex-row flex-col",children:[n(u,{className:"md:w-4/12 w-full p-3 flex flex-col",children:[e("span",{className:"text-md font-bold w-full",children:"Sales Campaign"}),e("span",{className:"mt-2 text-sm w-10/12",children:"This information will be used to specify tickets sale start and end dates."})]}),e(u,{className:"w-10/12 p-3",children:n(C,{direction:{base:"column",md:"row"},justifyContent:"space-between",children:[n(T,{mr:"5%",isRequired:!0,children:[e(I,{children:"Sale start time"}),e(k,{type:"datetime-local",name:"startTime",value:M(a.startTime&&a.startTime.length?new Date(a.startTime):new Date),onChange:b,disabled:s,min:M(new Date)})]}),n(T,{mr:"5%",ml:{base:"0",md:"5"},isRequired:!0,children:[e(I,{children:"Sale end time"}),e(k,{type:"datetime-local",name:"endTime",value:M(new Date(a.endTime)),disabled:s,onChange:b,min:E})]})]})})]}),n(C,{my:10,className:"w-full flex",justifyContent:"end",children:[e(N,{colorScheme:"red",mr:"2%",className:"sm:w-24 w-6/12",color:S("white","gray.100"),disabled:s,onClick:Z,children:"Reset"}),e(N,{colorScheme:"blue",className:"sm:w-24 w-6/12",_hover:{bg:S("green.400","green.500")},color:S("white","gray.100"),bg:S("green.500","green.600"),disabled:s,onClick:ue,children:"Save"})]})]})]})}const K=[{description:"Event Info"},{description:"Tickets"},{description:"Publish the event"}],mt=t=>{const[s,r]=m.useState({}),[o,c]=m.useState(null),{activeStep:d,goToNext:h,goToPrevious:y,setActiveStep:x}=Be({index:1,count:K.length}),p=Ae(),v=S("gray.100","gray.700"),E=()=>{r({}),x(1),t.onClose()},l=a=>{c(a)};return e(Q,{children:n(je,{isOpen:t.isOpen,onClose:E,size:"full",children:[e(te,{}),n(ze,{bg:v,children:[e(se,{}),e(ne,{children:e(j,{size:"xl",children:"Create an event"})}),e(ae,{children:e(u,{border:"1px",borderColor:S("gray.100","gray.400"),p:{base:"0px",sm:"25px"},borderRadius:"15px",shadow:"md",bg:S("gray.50","gray.600"),children:n(C,{flexDir:"column",children:[e($e,{index:d,orientation:p?"vertical":"horizontal",children:K.map((a,w)=>n(Oe,{children:[e(qe,{children:e(He,{complete:e(Ve,{}),incomplete:e(J,{}),active:e(J,{})})}),e(u,{flexShrink:"0",children:e(Ye,{children:a.description})}),!p&&e(We,{})]},w))}),d===1&&e(it,{onNext:()=>h(),eventId:t.eventId,onEventUpdate:l}),d===2&&e(nt,{onNext:()=>h(),eventId:t.eventId,statuses:t.statuses}),d===3&&e(ot,{onNext:h,entity:"Event",eventId:t.eventId,statuses:t.statuses}),n(C,{mt:"15px",children:[d!==1&&n(N,{onClick:y,children:["Previuos",e(Ge,{ml:"15px",width:"15px"})]}),d!==3&&n(N,{ml:d!==1?"15px":"0px",onClick:t.eventId&&h,isDisabled:!t.eventId,children:["Next",e(Qe,{ml:"15px",width:"15px"})]})]})]})})})]})]})})};export{mt as default};
